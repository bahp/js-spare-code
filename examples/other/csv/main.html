<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src='./papaparse.js'></script>
  <title>Title</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

  <style>

    body {
      margin-top: 40px;
    }

    input {
      width: 650px;
    }

    .output {
      overflow: scroll;
      /*margin: 1rem 0;*/
      height: 200px;
      width: 500px;
      border-radius: 25px;
      border: 1px solid gray;
      padding: 20px;
    }


  pre {
    overflow: scroll;
    min-height: 100px;
    max-height: 400px;
    display:inline-block;
  }

  </style>
</head>
<body>

  <div class="container">

    <p>Hello!</p>
    <p>Please open the developer tools!</p>
    <p>In chrome is located at "Settings > More Tools > Developer Tools".</p>

    <!-- ---------------------------- -->
    <!-- Load data from selected file -->
    <!-- ---------------------------- -->
    <br><br>
    <h5> Load from file </h5>
    <div id="local">
      <!--
        <input type="file" id="file-selector">
        <button id="submit-local">Load</button>
        <pre id="records-local">records </pre>
        <pre id="content-local" class="output"></pre>
      -->

      <div class="mb-1">
        <input class="form-control form-control-sm" id="file-selector" type="file">
      </div>
      <div class="form-group">
        <pre class="form-control form-control-sm mb-0"
             id="content-local" rows="7"></pre>
        <small class="text-muted"> Number of records:
          <span id="records-local"></span>
        </small>
      </div>

    </div>


    <!-- ---------------------------- -->
    <!-- Load data from web           -->
    <!-- ---------------------------- -->
    <br><br>
    <h5> Load from url </h5>
    <div id="online">
      <!--
        <input id='input-online' type="url" placeholder="url...">
        <button id="submit-online">Load</button>
        <pre id="records-online">Records: None</pre>
        <pre id="content-online"></pre>
      -->


      <div class="form-floating">
        <select id='web-selector'
              class="form-select form-select-sm custom-select">
          <option selected>--</option>
        </select>
         <label for="web-selector">Choose URL</label>
      </div>

      <!--
      <div class="input-group">
        <input type="text" class="form-control form-control-sm">
        <div class="input-group-append">
          <button class="btn btn-outline-secondary btn-group-sm" type="button">Button</button>
        </div>
      </div>
      -->

      <div class="input-group mb-1">
        <input type="url" class="form-control form-control-sm" id="web-input">
        <div class="input-group-append">
          <button class="btn btn-outline-secondary btn-group-sm" id="submit-online">Load</button>
        </div>
      </div>

      <div class="form-group">
        <pre class="form-control form-control-sm mb-0"
             id="content-online" rows="7"></pre>
        <small class="text-muted"> Number of records:
          <span id="records-online"></span>
        </small>
      </div>
    </div>
  </div>
</body>

<script>

  // Link: https://www.papaparse.com/
  // Link: https://leanylabs.com/blog/js-csv-parsers-benchmarks/#performance-benchmarks
  // Link: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file

  // ----------------------
  // Default urls
  // ----------------------
  var URLS = {
    'iris': 'https://gist.githubusercontent.com/netj/8836201/raw/6f9306ad21398ea43cba4f7d537619d0e07d5ae3/iris.csv',
    'categories': 'https://raw.githubusercontent.com/bahp/python-spare-code/master/datasets/collateral-sensitivity/sample/categories.csv',
    'shap': 'https://raw.githubusercontent.com/bahp/python-spare-code/master/datasets/shap/shap.csv'
  }

  function fillSelector(d, idTag) {
    /**
     * Fills the select tag
     *
     * Parameters
     * ----------
     * d : dict-like
     *    Dictionary where the key is the name and the value the url.
     * idTag: str
     *    The parameter id of the html element
     *
     **/

    // Get selector
    var obj = document.querySelector(idTag)

    // Loop dictionary
    for (let key in d) {

      // Build option
      let option = document.createElement("option");
      option.setAttribute('value', key);
      let optionText = document.createTextNode(d[key]);
      option.appendChild(optionText);

      // Append child
      obj.appendChild(option);
    }

  }

  // Fill selector with options
  fillSelector(URLS, '#web-selector')

  /**
   * Method 1: Manual split
   * ----------------------
   **/
  function csvToArray(str, delimiter = ",") {
    let array = str.split("\\r\\n").map(function (line) {
        return line.split(delimiter);
    });
    return array;
  }


  /**
   * Method 3: Using papaparse.js (local)
   * ------------------------------------
   **/

  // Variable file selector.
  const fileInput= document.querySelector('#file-selector');

  // Add event listener
  fileInput.addEventListener('change', (event) => {
    const fileList = event.target.files;

    // Read file and parse
    var reader = new FileReader();
    reader.readAsText(fileList[0]);
    reader.onload = function(event) {

      // Read file data and parse
      var csv = event.target.result;
      var data = Papa.parse(csv, {
        download: false,
        header: true,
        dynamicTyping: false,
        comments: '#',
      })

      // Show
      console.log(data)

      // Update interface
      document.getElementById('records-local').innerText = data.data.length;
      document.getElementById('content-local').innerText = csv;
    };

    // Display content (str-like)
    //reader.addEventListener('load', function() {
    //  document.getElementById('content-local').innerText = this.result;
    //});
  });


  /**
   * Method 3: Using papaparse.js (online)
   * ------------------------------------
   **/

  const webSelector = document.querySelector('#web-selector')

  // This code adds a listener to the select element so when
  // an URL is selected, this is set into the URL input element
  // and clicked (artificially).

  // Add event listener
  webSelector.addEventListener('change', (event) => {
    var name = event.target.value
    var url = event.target.options[event.target.selectedIndex].text;
    document.getElementById('web-input').value = url
    document.getElementById('submit-online').click()
  })


  // Variable file selector.
  const webInput = document.querySelector('#submit-online');

  // Add event listener
  webInput.addEventListener('click', (event) => {

     // Get url
     var url = document.getElementById('web-input').value

     console.log(url)

     // Download and parse
     Papa.parse(url, {
        download: true,
        header: true,
        complete: function(results) {
          // Get elements
          var text = document.querySelector('#content-online')
          var rows = document.querySelector('#records-online')
          // Set values
          rows.innerText = results.data.length;
          text.innerText = JSON.stringify(results.data, null, 4);
          // Show in console
          console.log(results);
        }
      });
  });


</script>
</html>